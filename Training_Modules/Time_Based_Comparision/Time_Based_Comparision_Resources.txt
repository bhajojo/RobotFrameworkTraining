*** Settings ***
Library           OperatingSystem
Library           Selenium2Library
Library           ExcelLibrary
Library           Collections
Library           DateTime
Variables         ../../Common_Resources/objRepPFM.py
Resource          ../../Common_Resources/common_resources.txt

*** Keywords ***
Date_Selection1
    [Documentation]    From and To date selection
    Open Excel    ${EXECDIR}/Test_Data/GlobalTestData.xls
    @{List}=    Get Row Values    Time Based Comparision    1
    Click Element    ${objOverviewDateIconOpen}
    sleep    1s
    press key    ${objFromDate}    \\9
    sleep    2s
    press key    ${objFromDate}    \\127
    Input text    ${objFromDate}    ${List[0][1]}
    sleep    1s
    capture page screenshot
    Click Element    ${objDateControl}
    sleep    1s
    press key    ${objToDate}    \\9
    sleep    1s
    Input text    ${objToDate}    ${List[1][1]}
    sleep    2s
    Click Element    ${objDateControl}
    capture page screenshot

Comparision_For_Previous_Period
    [Documentation]    To verify Time based comaprision for previous period.
    ...    - Click on Expense category
    ...    - Click on Expense subcategory
    ...    - Check same subgategory is available in Time Based Comparision section
    ...    - Verify Expense subcategory transaction amount == \ Expense subcategory transaction amount \ in Time Based Comparision section
    ...    - Verify bar chart length as per current and previous amount
    ...    - Check percentage as percentage =(New-Old)/old*100
    Date_Selection1
    Open Excel    ${EXECDIR}/Test_Data/GlobalTestData.xls
    @{CategoryColumn}=    Get Column Values    Time Based Comparision    2
    @{SubCategoryColumn}=    Get Column Values    Time Based Comparision    3
    Click Element    ${objComparisonCheckbox}
    Capture page screenshot
    Click element    xpath=.//*[@id='wrapper']//div[@class='title' and contains(.,'${CategoryColumn[4][1]}')]
    Sleep    2s
    Capture page screenshot
    ${SubCategoryName}=    Convert to string    ${SubCategoryColumn[4][1]}
    Click element    xpath=.//*[@id='wrapper']//..//div[@class='title' and contains(.,'${SubCategoryName}')]
    Sleep    2s
    Capture page screenshot
    Page should contain element    xpath=.//*[@id='wrapper']//div[5]/div[2]//div[@class='time-comparison__primary' and contains(.,'${SubCategoryName}')]
    ${SubCategory_Expense_amt}=    get text    xpath=.//*[@id='wrapper']//div[@class='title' and contains(.,'${SubCategoryName}')]//..//div[@class='amount']/span
    ${SubCategory_Expense_amt_fromTimeBasedComparision}=    Get Element Attribute    xpath=.//*[@id='wrapper']//div[5]/div[2]//div[@class='time-comparison' and contains(.,'${SubCategoryName}')]//..//div[@class='timeChart']/div[1]//div[@class='hbar__bar hbar__value--barvalue']//span@textContent
    ${SubCategory_Expense_amt_fromTimeBasedComparision_ForPreviousPeriod}=    Get Element Attribute    xpath=.//*[@id='wrapper']//div[5]/div[2]//div[@class='time-comparison' and contains(.,'${SubCategoryName}')]//..//div[@class='timeChart']/div[2]//div[@class='hbar__bar hbar__value--barvalue']//span@textContent
    ${CurrentPeriodBar}=    Get Element Attribute    xpath= .//*[@id='wrapper']//div[5]/div[2]//div[@class='time-comparison' and contains(.,'${SubCategoryName}')]//..//div[@class='timeChart']/div[1]//div[@class='hbar__bar hbar__primary']//div@style
    page should contain element    xpath= .//*[@id='wrapper']//div[5]/div[2]//div[@class='time-comparison' and contains(.,'${SubCategoryName}')]//..//div[@class='timeChart']/div[2]//div[@class='hbar__bar hbar__primary']
    ${PreviousPeriodBar}=    Get Element Attribute    xpath= .//*[@id='wrapper']//div[5]/div[2]//div[@class='time-comparison' and contains(.,'${SubCategoryName}')]//..//div[@class='timeChart']/div[2]//div[@class='hbar__bar hbar__primary']//div@style
    ${SubCategory_Expense_amt}    remove string    ${SubCategory_Expense_amt}    -    €    ,
    ${SubCategory_Expense_amt_fromTimeBasedComparision}    remove string    ${SubCategory_Expense_amt_fromTimeBasedComparision}    €    ,
    ${SubCategory_Expense_amt_fromTimeBasedComparision_ForPreviousPeriod}    remove string    ${SubCategory_Expense_amt_fromTimeBasedComparision}    €    ,
    Log    ${SubCategory_Expense_amt}
    Log    ${SubCategory_Expense_amt_fromTimeBasedComparision}
    ${CurrentPeriodBar}    remove string    ${CurrentPeriodBar}    width:    px;
    ${PreviousPeriodBar}    remove string    ${PreviousPeriodBar}    width:    px;
    should be equal    ${SubCategory_Expense_amt}    ${SubCategory_Expense_amt_fromTimeBasedComparision}
    ${Condition1}=    Run Keyword if    ${SubCategory_Expense_amt}>=${SubCategory_Expense_amt_fromTimeBasedComparision}    Log    Pass
    ${Condition3}=    Run Keyword if    ${CurrentPeriodBar}>=${PreviousPeriodBar}    Log    Pass
    ${Condition2}=    Run Keyword if    ${SubCategory_Expense_amt}<${SubCategory_Expense_amt_fromTimeBasedComparision}    Log    Pass
    ${Condition4}=    Run Keyword if    ${CurrentPeriodBar}<${PreviousPeriodBar}    Log    Pass
    Run Keyword if    ${Condition1}    ${Condition3}
    ...    ELSE    Run Keyword if    ${Condition2}    ${Condition4}
    ${CalculatedPercentage}    Evaluate    (${SubCategory_Expense_amt_fromTimeBasedComparision}- ${SubCategory_Expense_amt_fromTimeBasedComparision_ForPreviousPeriod}) / ${SubCategory_Expense_amt_fromTimeBasedComparision_ForPreviousPeriod}* 100
    ${CalculatedPercentage}    Convert to integer    ${CalculatedPercentage}
    ${Percentage_amt_fromTimeBasedComparision}=    get text    xpath=.//*[@id='wrapper']//div[5]/div[2]//div[@class='time-comparison' and contains(.,'${SubCategoryName}')]//..//div[@class='time-comparison__secondary']
    ${Percentage_amt_fromTimeBasedComparision}    remove string    ${Percentage_amt_fromTimeBasedComparision}    %
    Comment    ${ComparePercentage}    Should be true    ${Percentage_amt_fromTimeBasedComparision}    ${CalculatedPercentage}
    ${CheckCurrentPeriodAmountISNotZero}=    Run Keyword if    '${SubCategory_Expense_amt_fromTimeBasedComparision}'!='0'    Log    Pass
    ${CheckPreviousPeriodAmountISNotZero}=    Run Keyword if    '${SubCategory_Expense_amt_fromTimeBasedComparision_ForPreviousPeriod}'!='0'    Log    Pass
    Run Keyword if    ${CheckCurrentPeriodAmountISNotZero}    ${CheckPreviousPeriodAmountISNotZero}
    ...    ELSE    Should be true    ${Percentage_amt_fromTimeBasedComparision}    ${CalculatedPercentage}
    [Teardown]

Comparision_For_Previous_Year
    [Documentation]    To verify Time based comaprision for previous period.
    ...    - Click on Expense category
    ...    - Click on Expense subcategory
    ...    - Check same subgategory is available in Time Based Comparision section
    ...    - Verify Expense subcategory transaction amount == \ Expense subcategory transaction amount \ in Time Based Comparision section
    ...    - Verify bar chart length as per current and previous amount
    ...    - Check percentage as percentage =(New-Old)/old*100
    Date_Selection1
    Open Excel    ${EXECDIR}/Test_Data/GlobalTestData.xls
    @{CategoryColumn}=    Get Column Values    Time Based Comparision    2
    @{SubCategoryColumn}=    Get Column Values    Time Based Comparision    3
    Click Element    ${objComparisonCheckbox}
    Capture page screenshot
    Click element    ${objComareToDropdown}
    Sleep    1s
    Click element    ${objCompareToDropdownYearSelection}
    Sleep    2s
    Capture page screenshot
    Click element    ${objOverviewDateIconClose}
    Capture page screenshot
    Click element    xpath=.//*[@id='wrapper']//div[@class='title' and contains(.,'${CategoryColumn[4][1]}')]
    Sleep    2s
    Capture page screenshot
    ${SubCategoryName}=    Convert to string    ${SubCategoryColumn[4][1]}
    Click element    xpath=.//*[@id='wrapper']//..//div[@class='title' and contains(.,'${SubCategoryName}')]
    Sleep    2s
    Capture page screenshot
    Page should contain element    xpath=.//*[@id='wrapper']//div[5]/div[2]//div[@class='time-comparison__primary' and contains(.,'${SubCategoryName}')]
    ${SubCategory_Expense_amt}=    get text    xpath=.//*[@id='wrapper']//div[@class='title' and contains(.,'${SubCategoryName}')]//..//div[@class='amount']/span
    ${SubCategory_Expense_amt_fromTimeBasedComparision}=    Get Element Attribute    xpath=.//*[@id='wrapper']//div[5]/div[2]//div[@class='time-comparison' and contains(.,'${SubCategoryName}')]//..//div[@class='timeChart']/div[1]//div[@class='hbar__bar hbar__value--barvalue']//span@textContent
    ${SubCategory_Expense_amt_fromTimeBasedComparision_ForPreviousPeriod}=    Get Element Attribute    xpath=.//*[@id='wrapper']//div[5]/div[2]//div[@class='time-comparison' and contains(.,'${SubCategoryName}')]//..//div[@class='timeChart']/div[2]//div[@class='hbar__bar hbar__value--barvalue']//span@textContent
    ${CurrentPeriodBar}=    Get Element Attribute    xpath= .//*[@id='wrapper']//div[5]/div[2]//div[@class='time-comparison' and contains(.,'${SubCategoryName}')]//..//div[@class='timeChart']/div[1]//div[@class='hbar__bar hbar__primary']//div@style
    page should contain element    xpath= .//*[@id='wrapper']//div[5]/div[2]//div[@class='time-comparison' and contains(.,'${SubCategoryName}')]//..//div[@class='timeChart']/div[2]//div[@class='hbar__bar hbar__primary']
    ${PreviousPeriodBar}=    Get Element Attribute    xpath= .//*[@id='wrapper']//div[5]/div[2]//div[@class='time-comparison' and contains(.,'${SubCategoryName}')]//..//div[@class='timeChart']/div[2]//div[@class='hbar__bar hbar__primary']//div@style
    ${SubCategory_Expense_amt}    remove string    ${SubCategory_Expense_amt}    -    €    ,
    ${SubCategory_Expense_amt_fromTimeBasedComparision}    remove string    ${SubCategory_Expense_amt_fromTimeBasedComparision}    €    ,
    ${SubCategory_Expense_amt_fromTimeBasedComparision_ForPreviousPeriod}    remove string    ${SubCategory_Expense_amt_fromTimeBasedComparision}    €    ,
    Log    ${SubCategory_Expense_amt}
    Log    ${SubCategory_Expense_amt_fromTimeBasedComparision}
    ${CurrentPeriodBar}    remove string    ${CurrentPeriodBar}    width:    px;
    ${PreviousPeriodBar}    remove string    ${PreviousPeriodBar}    width:    px;
    should be equal    ${SubCategory_Expense_amt}    ${SubCategory_Expense_amt_fromTimeBasedComparision}
    ${Condition1}=    Run Keyword if    ${SubCategory_Expense_amt}>=${SubCategory_Expense_amt_fromTimeBasedComparision}    Log    Pass
    ${Condition3}=    Run Keyword if    ${CurrentPeriodBar}>=${PreviousPeriodBar}    Log    Pass
    ${Condition2}=    Run Keyword if    ${SubCategory_Expense_amt}<${SubCategory_Expense_amt_fromTimeBasedComparision}    Log    Pass
    ${Condition4}=    Run Keyword if    ${CurrentPeriodBar}<${PreviousPeriodBar}    Log    Pass
    Run Keyword if    ${Condition1}    ${Condition3}
    ...    ELSE    Run Keyword if    ${Condition2}    ${Condition4}
    ${CalculatedPercentage}    Evaluate    (${SubCategory_Expense_amt_fromTimeBasedComparision}- ${SubCategory_Expense_amt_fromTimeBasedComparision_ForPreviousPeriod}) / ${SubCategory_Expense_amt_fromTimeBasedComparision_ForPreviousPeriod}* 100
    ${CalculatedPercentage}    Convert to integer    ${CalculatedPercentage}
    ${Percentage_amt_fromTimeBasedComparision}=    get text    xpath=.//*[@id='wrapper']//div[5]/div[2]//div[@class='time-comparison' and contains(.,'${SubCategoryName}')]//..//div[@class='time-comparison__secondary']
    ${Percentage_amt_fromTimeBasedComparision}    remove string    ${Percentage_amt_fromTimeBasedComparision}    %
    Comment    ${ComparePercentage}    Should be true    ${Percentage_amt_fromTimeBasedComparision}    ${CalculatedPercentage}
    ${CheckCurrentPeriodAmountISNotZero}=    Run Keyword if    '${SubCategory_Expense_amt_fromTimeBasedComparision}'!='0'    Log    Pass
    ${CheckPreviousPeriodAmountISNotZero}=    Run Keyword if    '${SubCategory_Expense_amt_fromTimeBasedComparision_ForPreviousPeriod}'!='0'    Log    Pass
    Run Keyword if    ${CheckCurrentPeriodAmountISNotZero}    ${CheckPreviousPeriodAmountISNotZero}
    ...    ELSE    Should be true    ${Percentage_amt_fromTimeBasedComparision}    ${CalculatedPercentage}
    [Teardown]
