*** Settings ***

*** Keywords ***
Biggest_expenses
    [Documentation]    This keyword is desined to find out biggest 5 expenses from application and DB and compare their amount, beneficiary and date
    Connect To Database    ibm_db_dbi    PFM    DB2ADMIN    12Setup21    10.32.153.46    50000
    Log    Get top 5 expenses from DB
    @{ValueDate}=    query    select ValueDate from ttransaction \ where parent is Null and valuedate between '2016-06-01' and '2016-12-01' order by originalAmount asc fetch first 5 rows only
    @{Receiver}=    query    select Receiver from ttransaction \ where parent is Null and valuedate between '2016-06-01' and '2016-12-01' order by originalAmount asc fetch first 5 rows only
    @{Amount}=    query    select OriginalAmount from ttransaction \ where parent is Null and valuedate between '2016-06-01' and '2016-12-01' order by originalAmount asc fetch first 5 rows only
    Page Should contain Element    ${objBiggestTransactionLabel}
    Click Element    ${objCalenderExpandMore}
    Sleep    4S
    Clear Element Text    ${objFromDate}
    Input text    ${objFromDate}    06/01/2016
    Clear Element Text    ${objToDate}
    Input text    ${objToDate}    12/01/2016
    sleep    3S
    Capture Page Screenshot
    ${Index}=    Set variable    1
    Comment    To compare top 5 Expense amount with DB
    : FOR    ${Index}    IN RANGE    1    6
    \    ${AmountApp}=    get text    xpath= .//*[@id='wrapper']//div[3]/span/div[${Index}]//div[@class='amount']
    \    ${AmountApp}=    Remove String    ${AmountApp}    â‚¬    ,
    \    Log    ${AmountApp}
    \    ${AmountDB}=    Set Variable    ${Amount[${Index}-1]}
    \    ${AmountDB}=    Convert to String    ${AmountDB}
    \    ${AmountDB}=    Remove String    ${AmountDB}    (Decimal('    '),)
    \    Log    ${AmountDB}
    \    Should be Equal    ${AmountDB}    ${AmountApp}
    Comment    To compare top 5 Expense Beneficiary name with DB
    : FOR    ${Index}    IN RANGE    1    6
    \    ${ReceiverApp}=    get text    xpath = .//*[@id='wrapper']//div[3]/span/div[${Index}]//div[@class='beneficiary']
    \    Log    ${ReceiverApp}
    \    ${ReceiverDB}=    Set Variable    ${Receiver[${Index}-1]}
    \    ${ReceiverDB}=    Convert to String    ${ReceiverDB}
    \    ${ReceiverDB}=    Remove String    ${ReceiverDB}    (u'    ',)
    \    Log    ${ReceiverDB}
    \    Should be Equal    ${ReceiverDB}    ${ReceiverApp}
    Comment    To compare top 5 Expense Date with DB
    : FOR    ${Index}    IN RANGE    1    6
    \    ${DateApp}=    get text    xpath = .//*[@id='wrapper']//div[3]/span/div[${Index}]//div[@class='date']
    \    Log    ${DateApp}
    \    ${ValueDateDB}=    Set Variable    ${ValueDate[${Index}-1]}
    \    ${ValueDateDB}=    Convert to String    ${ValueDateDB}
    \    ${ValueDateDB}=    Remove String    ${ValueDateDB}    (datetime.datetime(    , 0, 0),)
    \    @{Date}=    Split String    ${ValueDateDB}    ,
    \    ${ValueDateDB}=    Set Variable    ${Date[1].strip()}/${Date[2].strip()}/${Date[0].strip()}
    \    Log    ${ValueDateDB}
    \    Should be Equal    ${ValueDateDB}    ${DateApp}
    Comment    To verify system opens tarnsaction page for all 5 expenses
    : FOR    ${Index}    IN RANGE    1    6
    \    ${AmountApp}=    get text    xpath= .//*[@id='wrapper']//div[3]/span/div[${Index}]//div[@class='amount']
    \    Click element    xpath= .//*[@id='wrapper']//div[3]/span/div[${Index}]//div[@class='amount']
    \    Sleep    3S
    \    Capture Page Screenshot
    \    Page Should Contain Element    ${objPopupTxnHeader}
    \    Comment    Page Should Contain Element    xpath = .//*[@id='wrapper']//p[@class='amount']/span[contains(.,'${AmountApp}')]
    \    Click element    ${objPopupClose}
    \    Sleep    2S
